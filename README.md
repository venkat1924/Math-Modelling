# Biological System Simulator & Parameter Estimator

This project presents a Streamlit web application for simulating a complex biological system governed by Ordinary Differential Equations (ODEs) and for performing inverse parameter estimation using a pre-trained Long Short-Term Memory (LSTM) neural network. Users can interactively adjust model parameters, run simulations to observe population dynamics, and see how well an LSTM model can recover these parameters from the generated time-series data.

---

## ðŸ“œ Overview

The core of this project involves a three-species biological interaction model. The application provides two main functionalities:

1.  **Forward Simulation**: Given a set of 13 biological parameters and initial population densities, the application numerically integrates the system of ODEs to predict and visualize the population dynamics of three species (X, Y, Z) over time.
2.  **Inverse Parameter Estimation**: Using the time-series data generated by the forward simulation, a pre-trained LSTM model attempts to predict the original 13 biological parameters that produced these dynamics. This demonstrates a powerful approach for model calibration and understanding complex systems where direct parameter measurement is challenging.

The application also includes detailed explanations of the underlying mathematical model and the roles of different parameters.

---

## âœ¨ Features

* **Interactive ODE Simulation**:
    * Adjust 13 distinct biological parameters with tooltips explaining their roles.
    * Set initial population densities for the three species (Xâ‚€, Yâ‚€, Zâ‚€).
    * Define the simulation time span and the number of evaluation points.
* **Dynamic Visualization**:
    * Population dynamics (X, Y, Z vs. time) are plotted using Plotly.
    * Option to view raw simulation data in a table.
* **LSTM-Based Parameter Prediction**:
    * A pre-trained LSTM model automatically processes the simulated population dynamics.
    * Predicts the 13 biological parameters that likely generated the observed dynamics.
    * Displays predicted parameters alongside the "true" input parameters for comparison.
* **Model Transparency**:
    * Displays the governing system of ODEs using LaTeX.
    * Provides interpretations of the equation terms and parameters.
    * Shows status of LSTM model loading and inference device (CPU/GPU).
* **Pre-trained Models**:
    * Utilizes a pre-trained LSTM model (`Weights/lstm_best_model.pth`) for immediate use.
    * Mentions an alternative CNN model (validation results and weights available, though LSTM performs better).

---

## ðŸ”¬ The Biological Model

The dynamics of the three interacting populations (X, Y, Z) are governed by the following system of Ordinary Differential Equations:

### State Variables
* **X**: Density of population X (e.g., resource, prey).
* **Y**: Density of population Y (e.g., consumer, predator, susceptible individuals).
* **Z**: Density of population Z (e.g., another consumer, predator, infected individuals).

### System of Equations
The mathematical model is defined as:

$$
\frac{dX}{dt} = \frac{rX}{1 + p_1Y + p_2Z} - d_1X - bX^2 - \frac{c_1(1 - m)X(Y + qZ)}{a + (1 - m)X}
$$

$$
\frac{dY}{dt} = \frac{h_1(1 - m)X(Y + qZ)}{a + (1 - m)X} - d_2Y - \lambda_1YZ
$$

$$
\frac{dZ}{dt} = \lambda_1YZ - (d_2 + d_3)Z
$$

### Parameters
The model behavior is controlled by 13 parameters:
* `r`: Intrinsic growth rate of X
* `p1`: Inhibition of Y on X
* `p2`: Inhibition of Z on X
* `d1`: Natural death rate of X
* `b`: Density-dependent death of X
* `c1`: Predation rate by Y/Z on X
* `a`: Saturation constant for X predation
* `m`: Modifier for X availability
* `h1`: Conversion efficiency for Y/Z
* `d2`: Natural death rate of Y & Z
* `d3`: Additional death rate of Z
* `lambda1` ($\lambda_1$): Interaction Y & Z (Y*Z term)
* `q`: Relative effect of Z vs Y on X

**General Interpretation of Terms (Examples):**
* The term $\frac{rX}{1 + p_1Y + p_2Z}$ often describes the logistic-like growth of population X, where its growth is inhibited by the densities of populations Y and Z.
* $d_1X$ represents the natural death rate of X, while $bX^2$ represents a density-dependent death or intra-species competition for X.
* The term $\frac{c_1(1 - m)X(Y + qZ)}{a + (1 - m)X}$ typically models a Holling Type II or similar functional response, representing the rate at which X is consumed by Y and Z.
* This consumption of X contributes to the growth of Y, as seen in the term $\frac{h_1(1 - m)X(Y + qZ)}{a + (1 - m)X}$ in the equation for $\frac{dY}{dt}$.
* $\lambda_1YZ$ represents an interaction between Y and Z, such as conversion or predation.
* $d_2Y$ and $(d_2 + d_3)Z$ are the decay or death rates for populations Y and Z.

---

## ðŸ“ˆ Forward Simulation

The "forward model" takes the defined parameters and initial conditions to simulate the system's evolution over time. The UI allows users to:
1.  Input values for the 13 parameters.
2.  Set initial conditions $X_0, Y_0, Z_0$.
3.  Define the simulation time window ($t_{start}, t_{end}$) and the number of points for evaluation.
4.  Click "Run Simulation" to integrate the ODEs using the `LSODA` method from `scipy.integrate.solve_ivp`.
5.  View the resulting population dynamics as a line plot and in a data table.

---

## ðŸ§  Inverse Parameter Estimation (LSTM Model)

The "inverse problem" involves deducing the model parameters ($r, p_1, \dots, q$) by observing the time-series dynamics of X, Y, and Z. This application uses a pre-trained LSTM model for this task.

### Model Architecture
The LSTM model (`ParameterPredictorLSTM`) has the following configuration:
* **Input Features**: 3 (densities of X, Y, Z at each time step)
* **Output Features**: 13 (the biological parameters)
* **LSTM Hidden Size**: 512
* **LSTM Number of Layers**: 4
* **LSTM Dropout Rate**: 0.2
* **LSTM Bidirectional**: True
* **Fully Connected Layers Dropout Rate**: 0.5

### Workflow
1.  The time-series data (X, Y, Z trajectories) from the forward simulation is used as input.
2.  The trajectory data is standardized using `StandardScaler`.
3.  The LSTM model processes this normalized sequence.
4.  The model outputs scaled parameter predictions.
5.  These predictions are unscaled using a `MinMaxScaler` (which was fit on the parameter ranges during training and loaded from the model checkpoint).
6.  The predicted parameters are displayed in the UI for comparison with the ground truth input values.

### Training Data
The LSTM model was trained on a dataset generated from diverse simulations of the ODE system.
* **Dataset Download Link**: [Google Drive](https://drive.google.com/file/d/1V8cGSz7iuIr__GmnDpRHyY8d87N39fBb/view?usp=sharing)
* To retrain the model, download the dataset and run the `Models/lstm.py` script.

### Pre-trained Model
* The application automatically loads the best performing LSTM model weights from `Weights/lstm_best_model.pth`.
* This checkpoint also includes the `param_scaler` (MinMaxScaler) necessary for unscaling the predictions.

---

## ðŸ”„ Alternative Model (CNN)

A Convolutional Neural Network (CNN) was also trained for the same parameter estimation task. While its performance was not as strong as the LSTM, its validation results and model weights are available in the `Validation_results` and `Weights` directories, respectively.

---

## ðŸ“ Project Structure (Expected)

```
.
â”œâ”€â”€ app.py                          # The main Streamlit UI Python script
â”œâ”€â”€ Models/
â”‚   â”œâ”€â”€ lstm.py                     # Script for training the LSTM model
|   â””â”€â”€ mcmc.py                     # Monte Carlo approach that was also explored
â”œâ”€â”€ Weights/
â”‚   â”œâ”€â”€ best_model_lstm.pth         # Pre-trained LSTM model weights and scaler
â”‚   â”œâ”€â”€ last_model_lstm.pth
â”‚   â”œâ”€â”€ best_model_cnn.pth          # Pre-trained CNN model weights and scaler
â”‚   â””â”€â”€ last_model_lstm.pth
â”œâ”€â”€ Validation_results/             # Files containing validation metrics for models
â”‚   â”œâ”€â”€ cnn_validation_results.csv
â”‚   â””â”€â”€ lstm_validation_results.csv  
â””â”€â”€ requirements.txt            # Python dependencies
```

---

## ðŸš€ Setup and Usage

### Prerequisites
* Python 3.10+
* PIP (Python package installer)

### Installation
1.  **Clone the repository (if applicable) or download the files.**
2.  **Create a virtual environment (recommended):**
    ```bash
    python -m venv venv
    source venv/bin/activate  # On Windows: venv\Scripts\activate
    ```
3.  **Install dependencies:**
    The project has an associated `requirements.txt`. Install the necessary packages using:
    ```bash
    pip install -r requirements.txt
    ```

### Running the Streamlit Application
1.  Ensure the pre-trained model `Weights/lstm_best_model.pth` is in the correct path relative to the Streamlit script.
2.  Open your terminal, navigate to the directory containing the Streamlit Python script (e.g., `your_streamlit_app_file.py`), and run:
    ```bash
    streamlit run app.py
    ```
3.  The application will open in your default web browser.

### (Optional) Training the LSTM Model
1.  **Download the dataset:**
    * From: [Google Drive](https://drive.google.com/file/d/1V8cGSz7iuIr__GmnDpRHyY8d87N39fBb/view?usp=sharing)
    * Place the downloaded CSV file into a `Data` directory in your project root.
2.  **Run the training script:**
    ```bash
    python Models/lstm.py
    ```
    This will train the LSTM model and save the best weights (e.g., to the `Weights/` directory).

---

## ðŸ’¡ Broader Scope & Future Work

This tool serves as a foundation for exploring complex biological dynamics and the power of machine learning in systems biology. As mentioned in the application:
> "In a broader research scope, such forward models are essential. We are actively working with (or envision using) this simulated data, or actual experimental data, to train an LSTM (Long Short-Term Memory) based inverse model. The objective of this neural network model is to perform parameter estimation: by observing the time-series dynamics of populations X, Y, and Z, the LSTM model would aim to deduce the underlying biological parameters ($r, p_1, \dots, q$) that generated these dynamics. This inverse problem is critical for calibrating models to real-world data and understanding complex biological systems when direct measurement of all parameters is infeasible."

---
